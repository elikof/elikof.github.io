<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
	
<style>
	body{
		background:white;
	}
button{
  background:yellow;
  font-size:20px;
  display:block;
  width:100%;
  height:100px;
}
</style>
</head>
<body>

<html>
<body>
<div id="acc"></div>
  <div id="rot"></div>
	<div id="resp"></div>
  <button onclick="onStart()">
    Start
  </button>
  <button onclick="onStop()">
    Stop
  </button>
</body>
</html>

<script>
let arr_x = [];
let arr_y = [];
let arr_z = [];
let arr_t = [];
let arr_xR = [];
let arr_yR = [];
let arr_zR = [];
let arr_tR = [];
const acc = document.getElementById("acc");
const rot = document.getElementById("rot");
const resp = document.getElementById("resp");
const sensor_acc = new Accelerometer({ frequency: 60 });
const sensor_rot = new Gyroscope({ frequency: 60 });
function onStart(){
  sensor_acc.start();
  sensor_rot.start();
}
function onStop(){
  sensor_acc.stop();
  sensor_rot.stop();
	
	$.ajax({
    url: "https://general-calculation-test.herokuapp.com/api/v1/calc_web",
    dataType: "json",
    data: JSON.stringify({ arr_x: arr_x,arr_y: arr_y,arr_z: arr_z,arr_t: arr_t,arr_xR: arr_x,arr_yR: arr_y,arr_zR: arr_z,arr_tR: arr_tR }),
    async: true,
    cache: false,
    timeout: 30000,
    headers: { "Content-type": "application/json"},
    success: function (data) {
	    resp.innerHTML = data;
         alert( "Got Result: " + data[0] );
	    	 arr_x = [];
	 arr_y = [];
	 arr_z = [];
	 arr_t = [];
	 arr_xR = [];
	 arr_yR = [];
	 arr_zR = [];
	 arr_tR = [];
    },
    error: function (request, status, error) {
         alert( "Server Error: " + status );
	    	 arr_x = [];
	 arr_y = [];
	 arr_z = [];
	 arr_t = [];
	 arr_xR = [];
	 arr_yR = [];
	 arr_zR = [];
	 arr_tR = [];
    },
    type: "POST"
});
//   axios.post('https://general-calculation-test.herokuapp.com/api/v1/calc_web', {
//  	arr_x: arr_x,arr_y: arr_y,arr_z: arr_z,arr_t: arr_t,
// 	arr_xR: arr_x,arr_yR: arr_y,arr_zR: arr_z,arr_tR: arr_tR
//   }
// 	    )
//   .then(function (response) {
// 	  alert('got response' + response);
// 	resp.innerHTML = response;
//   })
//   .catch(function (error) {
//     resp.innerHTML = error;
//   })
//   .then(function () {
//     // always executed
// 	 arr_x = [];
// 	 arr_y = [];
// 	 arr_z = [];
// 	 arr_t = [];
// 	 arr_xR = [];
// 	 arr_yR = [];
// 	 arr_zR = [];
// 	 arr_tR = [];
//   });  
}
sensor_acc.addEventListener("reading", function(e) {
  arr_x.push(e.target.x/9.8);
  arr_y.push(e.target.y/9.8);
  arr_z.push(e.target.z/9.8);
  arr_t.push(new Date().getTime()*1000000);
  acc.innerHTML = "acc: " + e.target.x;
});
sensor_rot.addEventListener("reading", function(e) {
  arr_xR.push(e.target.x);
  arr_yR.push(e.target.y);
  arr_zR.push(e.target.z);
  arr_tR.push(new Date().getTime()*1000000);
  rot.innerHTML = "rot: " + e.target.x;
});



//# sourceURL=userscript.js
</script>
</body>
</html>
